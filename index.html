<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Risk YÃ¶netimi | Ã‡oktan SeÃ§meli EÄŸitim (Alan SeÃ§imli + Sesli)</title>
<style>
:root{
  --bg:#050816;
  --panel:rgba(255,255,255,.06);
  --border:rgba(255,255,255,.12);
  --text:#e7e9ee;
  --muted:#aab0bd;
  --accent:#38bdf8;
  --good:#22c55e;
  --bad:#ef4444;
}
*{box-sizing:border-box;font-family:Inter,Segoe UI,Helvetica,Arial,sans-serif}
body{margin:0;background:radial-gradient(1200px 600px at 20% 10%, rgba(56,189,248,.18), transparent 55%),
radial-gradient(900px 500px at 80% 20%, rgba(34,197,94,.14), transparent 55%),
linear-gradient(160deg,#020617,#050816 60%,#020617);color:var(--text);}
header{position:sticky;top:0;z-index:10;backdrop-filter:blur(10px);
background:rgba(2,6,23,.6);border-bottom:1px solid var(--border);}
.wrap{max-width:1180px;margin:0 auto;padding:14px 18px;display:flex;gap:16px;align-items:center;justify-content:space-between;}
.brand{display:flex;align-items:center;gap:12px}
.avatar{width:44px;height:44px;border-radius:12px;overflow:hidden;border:1px solid var(--border);background:rgba(255,255,255,.08);}
.avatar img{width:100%;height:100%;object-fit:cover;display:block}
h1{font-size:16px;margin:0;font-weight:700;letter-spacing:.2px}
.sub{font-size:12px;color:var(--muted);line-height:1.35}
.stats{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}
.pill{font-size:12px;color:var(--muted);padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.04);}
main{max-width:1180px;margin:0 auto;padding:18px 18px 60px;}
.toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin:14px 0 18px}
.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
input[type="search"], select{padding:12px 12px;border-radius:12px;border:1px solid var(--border);
background:rgba(2,6,23,.55);color:var(--text);}
input[type="search"]{width:min(440px,100%)} 
.btn{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:rgba(2,6,23,.55);
color:var(--text);cursor:pointer}
.btn:hover{opacity:.92}
.btn.primary{background:linear-gradient(90deg,#0284c7,#22c55e);border:none}
.btn.ghost{background:rgba(255,255,255,.04)}
.card{padding:16px;border-radius:16px;background:var(--panel);border:1px solid var(--border)}
.qhead{display:flex;gap:12px;align-items:flex-start}
.qnum{min-width:46px;height:28px;border-radius:999px;display:flex;align-items:center;justify-content:center;
background:rgba(56,189,248,.16);border:1px solid rgba(56,189,248,.35);color:#7dd3fc;font-weight:700;font-size:12px}
.qtext{font-size:18px;line-height:1.4}
.opt{margin-top:12px;display:flex;gap:10px;align-items:flex-start;padding:10px;border-radius:14px;border:1px solid rgba(255,255,255,.12);
background:rgba(255,255,255,.03);cursor:pointer}
.opt:hover{border-color:rgba(56,189,248,.35)}
.opt input{margin-top:4px}
.opt .ot{font-size:16px;line-height:1.4}
.actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
.panel{display:none;margin-top:14px;padding:12px;border-radius:14px;border:1px dashed rgba(255,255,255,.18);background:rgba(255,255,255,.04)}
.panel.show{display:block}
.rationale{margin-top:10px;border-top:1px solid rgba(255,255,255,.12);padding-top:10px}
.row{display:flex;gap:10px;align-items:flex-start;margin:8px 0}
.bad{color:#fecaca} .good{color:#bbf7d0}
.tag{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.03);color:var(--muted)}
.small{font-size:12px;color:var(--muted);line-height:1.5}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media(max-width:980px){.grid{grid-template-columns:1fr}}
kbd{background:#020617;border:1px solid rgba(255,255,255,.2);border-radius:6px;padding:2px 6px;font-size:12px}
.toast{position:fixed;right:16px;bottom:20px;padding:10px 12px;border-radius:12px;
background:rgba(2,6,23,.75);border:1px solid var(--border);color:var(--text);display:none;max-width:380px;z-index:30}
.toast.show{display:block}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="brand">
      <div class="avatar" title="Anlatan kiÅŸi (fotoÄŸrafÄ± deÄŸiÅŸtirilebilir)">
        <img src="avatar.jpg" alt="Anlatan kiÅŸi"/>
      </div>
      <div>
        <h1>Risk YÃ¶netimi Â· Ã‡oktan SeÃ§meli EÄŸitim</h1>
        <div class="sub">
          Alan seÃ§ â†’ Soruyu oku â†’ ÅÄ±k seÃ§ â†’ <b>YanÄ±tla</b> â†’ DoÄŸru/YanlÄ±ÅŸ + nedenleri hem yazÄ±lÄ± hem <b>sesli</b> al.  
          KÄ±sayol: <kbd>N</kbd> (Quiz modunda yeni soru) Â· <kbd>Space</kbd> sesi durdur.
        </div>
      </div>
    </div>
    <div class="stats">
      <div class="pill">Toplam: <b id="total">0</b></div>
      <div class="pill">âœ… DoÄŸru: <b id="cok">0</b></div>
      <div class="pill">âŒ YanlÄ±ÅŸ: <b id="wok">0</b></div>
      <div class="pill">BaÅŸarÄ±: <b id="rate">0%</b></div>
    </div>
  </div>
</header>

<main>
  <div class="toolbar">
    <div class="controls">
      <select id="trackSel"></select>
      <select id="modeSel">
        <option value="practice">Pratik (liste)</option>
        <option value="quiz">Quiz (tek tek)</option>
      </select>
      <select id="voiceSel" title="Ses seÃ§imi"></select>
    </div>
    <div class="controls">
      <input id="search" type="search" placeholder="Ara: KRI, appetite, vendor..." oninput="render()"/>
      <button class="btn" onclick="shuffleBank()">KarÄ±ÅŸtÄ±r</button>
      <button class="btn" onclick="resetScore()">Skoru SÄ±fÄ±rla</button>
    </div>
  </div>

  <div class="small">
    <span class="tag">FotoÄŸraf</span> AynÄ± klasÃ¶re kendi fotoÄŸrafÄ±nÄ± <b>avatar.jpg</b> adÄ±yla koyarsan Ã¼stte sen gÃ¶rÃ¼nÃ¼r.
    <span class="tag">Sesli</span> â€œğŸ”Š YanÄ±tla (Sesli)â€ seÃ§imin neden doÄŸru/yanlÄ±ÅŸ olduÄŸunu okur.
  </div>

  <div id="quizHost" style="margin-top:14px;display:none"></div>
  <div id="listHost" class="grid" style="margin-top:14px"></div>
</main>

<div id="toast" class="toast"></div>

<script>
const BANK = [{"track": "ERM/Strateji", "q": "Risk en doÄŸru hangi ifade ile tanÄ±mlanÄ±r?", "opts": [{"t": "Olumsuz bir olayÄ±n kesin gerÃ§ekleÅŸmesi.", "ok": false, "why": "YanlÄ±ÅŸ: Risk kesinlik iÃ§ermez; olasÄ±lÄ±k vardÄ±r. Kesin gerÃ§ekleÅŸecek durum artÄ±k â€˜issueâ€™/planlama konusudur."}, {"t": "OlasÄ±lÄ±k ile etkinin birlikte deÄŸerlendirilmesi.", "ok": true, "why": "DoÄŸru: Risk, olasÄ±lÄ±k ve etkinin birlikte deÄŸerlendirilmesidir; Ã¶nceliklendirme bu iki boyutla yapÄ±lÄ±r."}, {"t": "Sadece finansal kayÄ±plarÄ± ifade eder.", "ok": false, "why": "YanlÄ±ÅŸ: Risk; finansal, operasyonel, itibar, uyum, gÃ¼venlik gibi farklÄ± etki tÃ¼rlerini kapsar."}, {"t": "Sadece teknik sistem hatalarÄ±nÄ± kapsar.", "ok": false, "why": "YanlÄ±ÅŸ: Riskin kaynaÄŸÄ± teknik olabilir ama risk yÃ¶netimi insan/sÃ¼reÃ§/tedarikÃ§i/regÃ¼lasyon boyutlarÄ±nÄ± da iÃ§erir."}]}, {"track": "ERM/Strateji", "q": "ISO 31000 iÃ§in en doÄŸru ifade hangisidir?", "opts": [{"t": "Sertifika zorunluluÄŸu olan denetim standardÄ±dÄ±r.", "ok": false, "why": "YanlÄ±ÅŸ: ISO 31000 bir â€˜rehberâ€™dir; prensipler, Ã§erÃ§eve ve sÃ¼reÃ§ Ã¶nerir; kurum baÄŸlamÄ±na gÃ¶re uyarlanÄ±r."}, {"t": "Her organizasyon iÃ§in risk yÃ¶netiminde prensip, Ã§erÃ§eve ve sÃ¼reÃ§ Ã¶nerir.", "ok": true, "why": "DoÄŸru: ISO 31000 yaklaÅŸÄ±mÄ± â€˜principles + framework + processâ€™ ÅŸeklinde ele alÄ±nÄ±r ve Ã¶lÃ§eklenebilir."}, {"t": "YalnÄ±z bilgi gÃ¼venliÄŸi riskleri iÃ§indir.", "ok": false, "why": "YanlÄ±ÅŸ: ISO 31000 kurumsal genel risk yÃ¶netimidir; BT gÃ¼venliÄŸiyle sÄ±nÄ±rlÄ± deÄŸildir."}, {"t": "Sadece proje riskleri iÃ§in kullanÄ±lÄ±r.", "ok": false, "why": "YanlÄ±ÅŸ: Projelerde uygulanÄ±r ama kapsamÄ± organizasyon geneli/stratejidir."}]}, {"track": "ERM/Strateji", "q": "COSO ERM (2017) Ã§erÃ§evesinin 5 bileÅŸeni hangisidir?", "opts": [{"t": "Planlama, Uygulama, Test, YayÄ±n, Ä°zleme", "ok": false, "why": "YanlÄ±ÅŸ: Bu yazÄ±lÄ±m yaÅŸam dÃ¶ngÃ¼sÃ¼ne benzer; COSO ERM bileÅŸenleri yÃ¶netiÅŸim/strateji/performance odaklÄ±dÄ±r."}, {"t": "Governance & Culture; Strategy & Objective-Setting; Performance; Review & Revision; Information, Communication & Reporting", "ok": true, "why": "DoÄŸru: COSO ERM 2017â€™nin 5 bileÅŸeni bu ÅŸekilde adlandÄ±rÄ±lÄ±r."}, {"t": "Kimlik, EriÅŸim, Åifreleme, Loglama, Yedekleme", "ok": false, "why": "YanlÄ±ÅŸ: Bunlar gÃ¼venlik kontrol alanlarÄ±dÄ±r; ERM bileÅŸenleri deÄŸildir."}, {"t": "Risk KaydÄ±, Risk Matrisi, KRI, KPI, SLA", "ok": false, "why": "YanlÄ±ÅŸ: Bunlar araÃ§/Ã§Ä±ktÄ±dÄ±r; Ã§erÃ§evenin bileÅŸeni deÄŸildir."}]}, {"track": "Proje", "q": "Proje riskleri ile issue (problem) arasÄ±ndaki doÄŸru fark hangisidir?", "opts": [{"t": "Issue gelecekte olabilir; risk geÃ§miÅŸte olmuÅŸtur.", "ok": false, "why": "YanlÄ±ÅŸ: Tersidir. Risk gelecekte olabilir; issue gerÃ§ekleÅŸmiÅŸtir."}, {"t": "Risk gelecekte olabilir; issue gerÃ§ekleÅŸmiÅŸtir.", "ok": true, "why": "DoÄŸru: Risk olasÄ±lÄ±k iÃ§erir; issue artÄ±k Ã§Ã¶zÃ¼m planÄ± gerektiren gerÃ§ekleÅŸmiÅŸ olaydÄ±r."}, {"t": "Risk sadece teknik; issue sadece iÅŸ tarafÄ±dÄ±r.", "ok": false, "why": "YanlÄ±ÅŸ: Her ikisi de teknik/iÅŸ/operasyon kaynaklÄ± olabilir."}, {"t": "Risk sadece bÃ¼tÃ§e; issue sadece zaman planÄ±dÄ±r.", "ok": false, "why": "YanlÄ±ÅŸ: Ä°kisi de kapsam, kalite, itibar, uyum gibi alanlarÄ± etkileyebilir."}]}, {"track": "Ä°nsan", "q": "Risk kÃ¼ltÃ¼rÃ¼nÃ¼n gÃ¼Ã§lÃ¼ olduÄŸuna dair en iyi iÅŸaret hangisidir?", "opts": [{"t": "Risk konuÅŸanlarÄ±n cezalandÄ±rÄ±lmasÄ±.", "ok": false, "why": "YanlÄ±ÅŸ: Bu â€˜sessiz riskâ€™ Ã¼retir; sorunlar gizlenir."}, {"t": "Near-miss ve risklerin hÄ±zlÄ±, suÃ§lamadan raporlanmasÄ± (speak-up).", "ok": true, "why": "DoÄŸru: KonuÅŸulabilirlik ve hÄ±zlÄ± raporlama risk kÃ¼ltÃ¼rÃ¼nÃ¼n Ã§ekirdeÄŸidir."}, {"t": "YalnÄ±z yÄ±llÄ±k denetim raporlarÄ± Ã¼retmek.", "ok": false, "why": "YanlÄ±ÅŸ: Denetim Ã¶nemli ama kÃ¼ltÃ¼r gÃ¼nlÃ¼k reflekslerle Ã¶lÃ§Ã¼lÃ¼r."}, {"t": "HiÃ§ incident yaÅŸanmamasÄ±.", "ok": false, "why": "YanlÄ±ÅŸ: â€˜HiÃ§â€™ gerÃ§ekÃ§i deÄŸildir; bazen raporlanmÄ±yordur."}]}, {"track": "Operasyon", "q": "Operasyonel risklerde â€˜KRIâ€™ ne iÅŸe yarar?", "opts": [{"t": "Performans hedefini Ã¶lÃ§er.", "ok": false, "why": "YanlÄ±ÅŸ: Bu KPIâ€™dÄ±r. KRI erken uyarÄ± sinyalidir."}, {"t": "Riskin yÃ¼kseldiÄŸini erken haber verir ve eÅŸik aÅŸÄ±mÄ±nda aksiyon tetikler.", "ok": true, "why": "DoÄŸru: KRI, riskin bÃ¼yÃ¼dÃ¼ÄŸÃ¼nÃ¼ â€˜olay olmadanâ€™ gÃ¶rmeyi saÄŸlar."}, {"t": "Sadece denetimde kullanÄ±lÄ±r.", "ok": false, "why": "YanlÄ±ÅŸ: AsÄ±l kullanÄ±m gÃ¼nlÃ¼k izleme ve aksiyon tetiklemedir."}, {"t": "Sadece finans departmanÄ± takip eder.", "ok": false, "why": "YanlÄ±ÅŸ: KRIâ€™lar sÃ¼reÃ§ sahibine ve yÃ¶netime gÃ¶rÃ¼nÃ¼r olmalÄ±dÄ±r."}]}, {"track": "BT/GÃ¼venlik", "q": "NIST yaklaÅŸÄ±mÄ±yla tipik risk faktÃ¶rleri hangilerini iÃ§erir?", "opts": [{"t": "Tehdit, zafiyet, olasÄ±lÄ±k, etki ve baÄŸlamsal (predisposing) koÅŸullar.", "ok": true, "why": "DoÄŸru: Risk faktÃ¶rleri bu bileÅŸenlerle aÃ§Ä±klanÄ±r; kurum bunlarÄ± dokÃ¼mante etmelidir."}, {"t": "Sadece ÅŸifreleme ve firewall.", "ok": false, "why": "YanlÄ±ÅŸ: Bunlar kontrol Ã¶rnekleridir; risk faktÃ¶rÃ¼ seti deÄŸildir."}, {"t": "Sadece â€˜tehditâ€™ yeterlidir.", "ok": false, "why": "YanlÄ±ÅŸ: Tehdit tek baÅŸÄ±na risk deÄŸildir; zafiyet + olasÄ±lÄ±k + etki ile anlam kazanÄ±r."}, {"t": "Sadece finansal kayÄ±p.", "ok": false, "why": "YanlÄ±ÅŸ: GÃ¼venlikte etki gizlilik, bÃ¼tÃ¼nlÃ¼k, eriÅŸilebilirlik ve itibar boyutlarÄ±nÄ± iÃ§erir."}]}, {"track": "TedarikÃ§i/Vendor", "q": "TedarikÃ§i (vendor) riski iÃ§in en doÄŸru yaklaÅŸÄ±m hangisidir?", "opts": [{"t": "SÃ¶zleÅŸme imzalanÄ±nca risk biter.", "ok": false, "why": "YanlÄ±ÅŸ: SÃ¶zleÅŸme baÅŸlangÄ±Ã§tÄ±r; SLA izleme, denetim hakkÄ±, BCP ve Ã¶lÃ§Ã¼m gerekir."}, {"t": "SLA + KRIâ€™lar + dÃ¼zenli performans review + exit plan (alternatif) birlikte tasarlanmalÄ±dÄ±r.", "ok": true, "why": "DoÄŸru: Vendor riskini azaltmak iÃ§in Ã¶lÃ§Ã¼m, yÃ¶netiÅŸim ve Ã§Ä±kÄ±ÅŸ stratejisi ÅŸarttÄ±r."}, {"t": "Vendor hatasÄ± olursa mÃ¼ÅŸteriyle iletiÅŸim kurmayÄ±z.", "ok": false, "why": "YanlÄ±ÅŸ: Ä°letiÅŸim/itibar yÃ¶netimi kritik; kullanÄ±cÄ±ya ÅŸeffaf ve yÃ¶nlendirici bilgi verilmeli."}, {"t": "Sadece fiyat pazarlÄ±ÄŸÄ± yapmak yeterlidir.", "ok": false, "why": "YanlÄ±ÅŸ: En ucuz Ã§Ã¶zÃ¼m en pahalÄ± riski doÄŸurabilir; dayanÄ±klÄ±lÄ±k ve uyum ÅŸart."}]}, {"track": "Proje", "q": "Pre-mortem tekniÄŸinin amacÄ± nedir?", "opts": [{"t": "Projeyi baÅŸarÄ± hikayesine Ã§evirmek iÃ§in motivasyon sunumu yapmak.", "ok": false, "why": "YanlÄ±ÅŸ: Bu iletiÅŸim tekniÄŸi olabilir; pre-mortem deÄŸildir."}, {"t": "Proje â€˜baÅŸarÄ±sÄ±z olduâ€™ varsayÄ±mÄ±yla nedenleri Ã¶nden bulup Ã¶nlem Ã¼retmek.", "ok": true, "why": "DoÄŸru: BaÅŸarÄ±sÄ±zlÄ±k sebeplerini erken Ã§Ä±karÄ±p mitigasyon Ã¼retir."}, {"t": "Sadece teknik penetrasyon testi yapmak.", "ok": false, "why": "YanlÄ±ÅŸ: Teknik test bir araÃ§tÄ±r; pre-mortem Ã§ok disiplinli senaryo Ã§alÄ±ÅŸmasÄ±dÄ±r."}, {"t": "YalnÄ±z retrospektif toplantÄ±sÄ± yapmak.", "ok": false, "why": "YanlÄ±ÅŸ: Retrospektif geÃ§miÅŸe bakar; pre-mortem gelecekteki baÅŸarÄ±sÄ±zlÄ±ÄŸÄ± simÃ¼le eder."}]}, {"track": "Ä°nsan", "q": "â€˜Tek kiÅŸi baÄŸÄ±mlÄ±lÄ±ÄŸÄ±â€™ (key person risk) en iyi nasÄ±l azaltÄ±lÄ±r?", "opts": [{"t": "O kiÅŸiyi daha Ã§ok iÅŸ yÃ¼kÃ¼yle Ã¶dÃ¼llendirerek.", "ok": false, "why": "YanlÄ±ÅŸ: Risk bÃ¼yÃ¼r; bilgi daha da tek kiÅŸide kilitlenir."}, {"t": "DokÃ¼mantasyon + gÃ¶lge Ã§alÄ±ÅŸma + rotasyon + yedekleme planÄ±yla.", "ok": true, "why": "DoÄŸru: Bilgi tek kiÅŸiden Ã§Ä±karÄ±lÄ±p sÃ¼reÃ§ haline getirildiÄŸinde risk dÃ¼ÅŸer."}, {"t": "Konuyu hiÃ§ konuÅŸmayarak.", "ok": false, "why": "YanlÄ±ÅŸ: Sessiz risk Ã¼retir."}, {"t": "Sadece prim vermekle.", "ok": false, "why": "YanlÄ±ÅŸ: Motivasyon Ã¶nemli ama risk kontrolÃ¼ sÃ¼reÃ§ ister."}]}, {"track": "BT/GÃ¼venlik", "q": "ÃœÃ§ Hat Modelinde (Three Lines) 1. hattÄ±n rolÃ¼ nedir?", "opts": [{"t": "BaÄŸÄ±msÄ±z denetim yapmak.", "ok": false, "why": "YanlÄ±ÅŸ: Bu 3. hattÄ±r (internal audit)."}, {"t": "GÃ¼nlÃ¼k operasyon iÃ§inde riski sahiplenmek ve yÃ¶netmek.", "ok": true, "why": "DoÄŸru: 1. hat riskin sahibidir; kontrolleri uygular."}, {"t": "Sadece politika yazmak.", "ok": false, "why": "YanlÄ±ÅŸ: Ã‡oÄŸunlukla 2. hat politika/standart Ã¼retir."}, {"t": "YalnÄ±z raporlama yapmak.", "ok": false, "why": "YanlÄ±ÅŸ: Raporlama yardÄ±mcÄ±dÄ±r; asÄ±l sorumluluk risk yÃ¶netimidir."}]}, {"track": "ERM/Strateji", "q": "Risk appetite ile risk tolerance arasÄ±ndaki fark nedir?", "opts": [{"t": "AynÄ± kavramdÄ±r.", "ok": false, "why": "YanlÄ±ÅŸ: Appetite genel isteklilik; tolerance hedef bazlÄ± kabul edilebilir sapma aralÄ±ÄŸÄ±dÄ±r."}, {"t": "Appetite genel yÃ¶n; tolerance limit/eÅŸiklerle gÃ¼nlÃ¼k karara Ã§evrilen sapma aralÄ±ÄŸÄ±dÄ±r.", "ok": true, "why": "DoÄŸru: Tolerans, appetiteâ€™in operasyonel karÅŸÄ±lÄ±ÄŸÄ±dÄ±r."}, {"t": "Tolerance sadece denetim terimidir.", "ok": false, "why": "YanlÄ±ÅŸ: Tolerance gÃ¼nlÃ¼k eÅŸik/limitlere dÃ¶nÃ¼ÅŸmelidir."}, {"t": "Appetite sadece BT, tolerance sadece finans iÃ§indir.", "ok": false, "why": "YanlÄ±ÅŸ: Ä°kisi de kurumsal tÃ¼m alanlarÄ± kapsar."}]}];
let correct=0, wrong=0;

function toast(msg){ const t=document.getElementById('toast'); t.innerText=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 1800); }
function updStats(total){
  document.getElementById('total').innerText = total;
  document.getElementById('cok').innerText = correct;
  document.getElementById('wok').innerText = wrong;
  const done = correct + wrong;
  document.getElementById('rate').innerText = done ? Math.round((correct/done)*100) + '%' : '0%';
}

// TTS
let voices=[], currentVoice=null;
function loadVoices(){
  voices = window.speechSynthesis ? window.speechSynthesis.getVoices() : [];
  const sel = document.getElementById('voiceSel');
  sel.innerHTML = '';
  if(!voices.length){ sel.innerHTML = '<option>Ses yok</option>'; return; }
  const sorted = [...voices].sort((a,b)=>{
    const at = (a.lang||'').toLowerCase().startsWith('tr') ? 0 : 1;
    const bt = (b.lang||'').toLowerCase().startsWith('tr') ? 0 : 1;
    return at-bt;
  });
  sorted.forEach(v=>{
    const opt = document.createElement('option');
    opt.value = v.name;
    opt.textContent = `${v.name} (${v.lang})`;
    sel.appendChild(opt);
  });
  sel.onchange = ()=>{ currentVoice = voices.find(v=>v.name===sel.value) || null; toast("Ses seÃ§ildi."); };
  sel.value = sorted[0].name;
  currentVoice = voices.find(v=>v.name===sel.value) || null;
}
if(window.speechSynthesis){ loadVoices(); window.speechSynthesis.onvoiceschanged = loadVoices; }

function speak(text){
  if(!window.speechSynthesis){ toast("Sesli okuma desteklenmiyor."); return; }
  window.speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  if(currentVoice) u.voice = currentVoice;
  u.lang = currentVoice?.lang || 'tr-TR';
  u.rate = 1.0; u.pitch = 1.0;
  window.speechSynthesis.speak(u);
}
document.addEventListener('keydown', (e)=>{ if(e.code==='Space'){ window.speechSynthesis?.cancel(); toast("Ses durduruldu."); } });

function uniqTracks(){
  return ["TÃ¼mÃ¼", ...Array.from(new Set(BANK.map(x=>x.track)))];
}
function buildSelectors(){
  const ts = document.getElementById('trackSel');
  ts.innerHTML='';
  uniqTracks().forEach(t=>{
    const o=document.createElement('option');
    o.value=t; o.textContent=t;
    ts.appendChild(o);
  });
  ts.onchange = ()=>render();
  document.getElementById('modeSel').onchange = ()=>render();
}
buildSelectors();

function getFiltered(){
  const track = document.getElementById('trackSel').value;
  const q = document.getElementById('search').value.toLowerCase().trim();
  return BANK.filter(x=> (track==="TÃ¼mÃ¼" || x.track===track) && (q==="" || (x.q+" "+x.opts.map(o=>o.t).join(" ")).toLowerCase().includes(q)));
}

function optionRow(opt, idx, name){
  return `<label class="opt"><input type="radio" name="${name}" value="${idx}"/><div class="ot">${opt.t}</div></label>`;
}

function buildExplanation(item, chosenIdx){
  const correctIdx = item.opts.findIndex(o=>o.ok);
  const chosen = item.opts[chosenIdx];
  const isCorrect = chosenIdx===correctIdx;

  let html = `<div><span class="tag">${isCorrect?'âœ… DoÄŸru':'âŒ YanlÄ±ÅŸ'}</span>
    <span class="tag">DoÄŸru ÅÄ±k: ${String.fromCharCode(65+correctIdx)}</span></div>`;

  html += `<div class="rationale">
    <div class="row"><b>SeÃ§imin:</b> ${String.fromCharCode(65+chosenIdx)}) ${chosen.t}</div>
    <div class="row ${isCorrect?'good':'bad'}">${isCorrect?'Neden doÄŸru?':'Neden yanlÄ±ÅŸ?'} ${chosen.why}</div>
    ${!isCorrect ? `<div class="row good"><b>DoÄŸru neden doÄŸru?</b> ${item.opts[correctIdx].why}</div>` : ''}
    <div class="row"><b>TÃ¼m ÅŸÄ±klar â€“ aÃ§Ä±klama:</b></div>
    ${item.opts.map((o,idx)=>`<div class="row ${o.ok?'good':'bad'}"><div style="min-width:44px"><b>${String.fromCharCode(65+idx)})</b> ${o.ok?'âœ…':'âŒ'}</div><div>${o.why}</div></div>`).join('')}
  </div>`;

  return { html, correctIdx, isCorrect };
}

function renderPractice(items){
  document.getElementById('quizHost').style.display='none';
  const host = document.getElementById('listHost');
  host.style.display='grid';

  host.innerHTML = items.map((item, i)=>{
    const name = `q_${i}`;
    const opts = item.opts.map((o,idx)=>optionRow(o,idx,name)).join('');
    return `<div class="card">
      <div class="qhead">
        <div class="qnum">S${String(i+1).padStart(2,'0')}</div>
        <div class="qtext">${item.q}<div class="small"><span class="tag">${item.track}</span></div></div>
      </div>
      <div class="opts">${opts}</div>
      <div class="actions">
        <button class="btn primary" onclick="answerPractice(${i}, '${name}', false)">YanÄ±tla</button>
        <button class="btn ghost" onclick="answerPractice(${i}, '${name}', true)">ğŸ”Š YanÄ±tla (Sesli)</button>
      </div>
      <div class="panel" id="panel_${i}"></div>
    </div>`;
  }).join('');

  updStats(items.length);
}

function answerPractice(i, name, doSpeak){
  const items = getFiltered();
  const item = items[i];
  const radios = document.getElementsByName(name);
  let chosenIdx = -1;
  radios.forEach(r=>{ if(r.checked) chosenIdx = parseInt(r.value,10); });
  if(chosenIdx<0){ toast("Ã–nce bir ÅŸÄ±k seÃ§."); return; }

  const ex = buildExplanation(item, chosenIdx);
  const panel = document.getElementById('panel_'+i);
  panel.innerHTML = ex.html;
  panel.classList.add('show');

  if(ex.isCorrect) correct++; else wrong++;
  updStats(items.length);

  if(doSpeak){
    const correctIdx = ex.correctIdx;
    const chosen = item.opts[chosenIdx];
    const msg = `${item.q}. SeÃ§imin ${String.fromCharCode(65+chosenIdx)}. ` +
      (ex.isCorrect ? `DoÄŸru. ${chosen.why}` : `YanlÄ±ÅŸ. ${chosen.why}. DoÄŸru seÃ§enek ${String.fromCharCode(65+correctIdx)}. ${item.opts[correctIdx].why}`);
    speak(msg);
  }
}

// Quiz mode
let quizItems = [];
let quizIndex = 0;

function renderQuiz(items){
  quizItems = items;
  document.getElementById('listHost').style.display='none';
  const host = document.getElementById('quizHost');
  host.style.display='block';

  if(!items.length){
    host.innerHTML = '<div class="card">SonuÃ§ yok.</div>';
    updStats(0);
    return;
  }

  quizIndex = Math.max(0, Math.min(quizIndex, items.length-1));
  const item = items[quizIndex];
  const name = 'quiz_q';
  const opts = item.opts.map((o,idx)=>optionRow(o,idx,name)).join('');

  host.innerHTML = `<div class="card">
    <div class="qhead">
      <div class="qnum">Q</div>
      <div class="qtext">${item.q}
        <div class="small"><span class="tag">${item.track}</span> <span class="tag">${quizIndex+1} / ${items.length}</span></div>
      </div>
    </div>
    <div class="opts">${opts}</div>
    <div class="actions">
      <button class="btn primary" onclick="answerQuiz(false)">YanÄ±tla</button>
      <button class="btn ghost" onclick="answerQuiz(true)">ğŸ”Š YanÄ±tla (Sesli)</button>
      <button class="btn" onclick="nextQuiz()">Yeni Soru</button>
    </div>
    <div class="panel" id="quizPanel"></div>
  </div>`;

  updStats(items.length);
}

function answerQuiz(doSpeak){
  const item = quizItems[quizIndex];
  const radios = document.getElementsByName('quiz_q');
  let chosenIdx = -1;
  radios.forEach(r=>{ if(r.checked) chosenIdx = parseInt(r.value,10); });
  if(chosenIdx<0){ toast("Ã–nce bir ÅŸÄ±k seÃ§."); return; }

  const ex = buildExplanation(item, chosenIdx);
  const panel = document.getElementById('quizPanel');
  panel.innerHTML = ex.html;
  panel.classList.add('show');

  if(ex.isCorrect) correct++; else wrong++;
  updStats(quizItems.length);

  if(doSpeak){
    const correctIdx = ex.correctIdx;
    const chosen = item.opts[chosenIdx];
    const msg = `${item.q}. SeÃ§imin ${String.fromCharCode(65+chosenIdx)}. ` +
      (ex.isCorrect ? `DoÄŸru. ${chosen.why}` : `YanlÄ±ÅŸ. ${chosen.why}. DoÄŸru seÃ§enek ${String.fromCharCode(65+correctIdx)}. ${item.opts[correctIdx].why}`);
    speak(msg);
  }
}

function nextQuiz(){
  if(!quizItems.length) return;
  quizIndex = (quizIndex + 1) % quizItems.length;
  renderQuiz(quizItems);
}

document.addEventListener('keydown', (e)=>{
  if(e.key.toLowerCase()==='n' && document.getElementById('modeSel').value==='quiz'){
    nextQuiz();
  }
});

function shuffleBank(){
  for(let i=BANK.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [BANK[i],BANK[j]] = [BANK[j],BANK[i]];
  }
  render();
}

function resetScore(){ correct=0; wrong=0; render(); toast("Skor sÄ±fÄ±rlandÄ±."); }

function render(){
  const items = getFiltered();
  const mode = document.getElementById('modeSel').value;
  if(mode==='quiz') renderQuiz(items);
  else renderPractice(items);
}
render();
</script>
</body>
</html>
